<section class="ascension-draft">
  <div class="draft-shell">
    <header class="ascension-draft__header">
      <div class="header-title">Ascension // <strong>Draft</strong></div>
    </header>
    <div class="draft-scroll">
      @if (state$ | async; as state) {
      <div class="draft-layout">
        <aside class="draft-sidebar">
          <div class="panel summary-panel">
            <div class="panel-header">
              <span>Run Summary</span>
            </div>
            <div class="summary-grid">
              <div class="panel-row">
                <span class="panel-label">Floor</span>
                <span class="panel-value">
                  {{ state.floorIndex }}/{{ totalFloors }}
                </span>
              </div>
              <div class="panel-row">
                <span class="panel-label">Echo Fragments</span>
                <span class="panel-value">{{ state.echoFragments }}</span>
              </div>
              <div class="panel-row">
                <span class="panel-label">Origin Path</span>
                <span class="panel-value"
                  >{{ pathName(state.originPathId) }}</span
                >
              </div>
              <div class="panel-row">
                <span class="panel-label">Run Path</span>
                <span class="panel-value">{{ pathName(state.runPathId) }}</span>
              </div>
              <div class="panel-row">
                <span class="panel-label">Resonance</span>
                <span
                  class="panel-value"
                  [class.panel-value--active]="resonanceActive(state)"
                >
                  {{ resonanceActive(state) ? 'Active' : 'Inactive' }}
                </span>
              </div>
            </div>
            <div class="panel-section">
              <div class="panel-section__title">Progress</div>
              <div class="panel-row">
                <span class="panel-label">Origin Echoes</span>
                <span class="panel-value">{{ state.originEchoCount }}/3</span>
              </div>
              <div class="panel-row">
                <span class="panel-label">Run Echoes</span>
                <span class="panel-value">{{ state.runEchoCount }}/2</span>
              </div>
            </div>
          </div>
        </aside>

        <section class="draft-main">
          <div class="panel draft-panel">
            <div class="panel-header">
              <span>Echo Draft</span>
              <span class="panel-meta">Hotkeys 1-3</span>
            </div>
            @if (offer.length) {
            <div class="offer-grid">
              @for (option of offer; track option.id; let index = $index) {
              <button
                type="button"
                class="echo-card"
                (click)="selectOption(option)"
                [disabled]="isResolving"
                [class.echo-card--selected]="selectedOptionId === option.id"
                [attr.aria-label]="'Select ' + (option.kind === 'echo' ? option.echo.name : option.name)"
              >
                <div class="echo-card__tag">
                  <span class="path-badge"> {{ pathBadge(option) }} </span>
                  <span
                    class="source-tag"
                    [class.source-tag--origin]="sourceRole(option, state) === 'origin'"
                    [class.source-tag--run]="sourceRole(option, state) === 'run'"
                    [class.source-tag--flex]="sourceRole(option, state) === 'flex'"
                  >
                    {{ sourceRoleLabel(option, state) }}
                  </span>
                </div>
                <div class="echo-card__name">
                  {{ option.kind === 'echo' ? option.echo.name : option.name }}
                </div>
                <div class="echo-card__desc">
                  {{ option.kind === 'echo' ? option.echo.description :
                  option.description }}
                </div>
                @if (resonanceImpact(option, state); as impact) {
                <div
                  class="echo-card__impact"
                  [class.echo-card__impact--none]="impact.kind === 'none'"
                  [class.echo-card__impact--origin]="impact.kind === 'origin'"
                  [class.echo-card__impact--run]="impact.kind === 'run'"
                >
                  @if (impact.kind === 'none') {
                  <span class="impact-neutral">{{ impact.label }}</span>
                  } @else {
                  <div class="impact-row">
                    <span class="impact-label">{{ impact.label }}</span>
                    <span class="impact-values">
                      <span>{{ impact.before }}/{{ impact.max }}</span>
                      <span class="impact-arrow">-&gt;</span>
                      <span>{{ impact.after }}/{{ impact.max }}</span>
                    </span>
                  </div>
                  }
                </div>
                }
                <div class="echo-card__footer draft-card__actions">
                  <span class="draft-choose-btn">Choose</span>
                  <span class="draft-hotkey-chip">
                    {{ hotkeyLabel(index) }}
                  </span>
                </div>
              </button>
              }
            </div>
            } @else {
            <div class="empty-state">No echoes available.</div>
            }
          </div>
        </section>
      </div>

      @if (bannerMessage) {
      <div class="resonance-banner">{{ bannerMessage }}</div>
      } }
    </div>
  </div>
</section>
