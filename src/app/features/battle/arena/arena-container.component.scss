:host {
  --arena-radius: 18px;
  --arena-frame-bg: radial-gradient(
    90% 70% at 50% 30%,
    rgba(255, 255, 255, 0.06),
    rgba(5, 5, 17, 0.9)
  );
  --vfx-ambient-opacity: calc(0.05 + var(--vfx-intensity, 0) * 0.14);
  --vfx-flicker-strength: calc(0.02 + var(--vfx-intensity, 0) * 0.05);
  --vfx-field-opacity: calc(0.02 + var(--vfx-intensity, 0) * 0.08);

  display: block;
  width: 100%;
  height: 100%;
}

.arena-shell {
  flex: 1;
  width: 100%;
  height: 100%;
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 3px;
}

.arena-frame {
  position: relative;
  width: clamp(320px, 88vw, var(--arena-width, 1100px));
  height: clamp(320px, 72vh, var(--arena-height, 620px));
  max-width: var(--arena-width, 1100px);
  max-height: var(--arena-height, 620px);
  min-width: 320px;
  min-height: 340px;
  border-radius: var(--arena-radius);
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.08);
  background: var(--arena-frame-bg);
  box-sizing: border-box;
  will-change: transform;
  transform: translateZ(0);
}

.arena-frame::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      120% 80% at 50% 90%,
      rgba(0, 0, 0, 0.35),
      transparent 55%
    ),
    radial-gradient(
      120% 120% at 50% 20%,
      rgba(120, 160, 255, var(--vfx-field-opacity)),
      transparent 70%
    ),
    repeating-linear-gradient(
      120deg,
      rgba(255, 255, 255, var(--vfx-field-opacity)) 0px,
      rgba(255, 255, 255, var(--vfx-field-opacity)) 1px,
      transparent 1px,
      transparent 7px
    );
  opacity: 0.55;
  z-index: 1;
  pointer-events: none;
}

.arena-frame::after {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      120% 90% at 50% 15%,
      rgba(255, 214, 160, 0.1),
      transparent 60%
    ),
    radial-gradient(
      120% 80% at 65% 85%,
      rgba(120, 160, 255, 0.08),
      transparent 65%
    ),
    repeating-linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.025) 0px,
      rgba(255, 255, 255, 0.025) 1px,
      transparent 1px,
      transparent 4px
    );
  opacity: var(--vfx-ambient-opacity);
  mix-blend-mode: screen;
  z-index: 2;
  pointer-events: none;
  animation: arena-flicker 2.8s ease-in-out infinite;
}

.arena-layer {
  position: absolute;
  inset: 0;
}

.arena-layer--background {
  z-index: 0;
  pointer-events: none;
  overflow: hidden;
}

.arena-layer--actors {
  z-index: 10;
  pointer-events: none;
}

.arena-layer--vfx {
  z-index: 20;
  pointer-events: none;
}

.arena-layer--ui {
  z-index: 30;
  pointer-events: auto;
}

.arena-bg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: translate3d(0, 0, 0) scale(1.03);
  animation: arena-parallax 22s ease-in-out infinite;
  will-change: transform;
}

.arena-layer--background::after {
  content: "";
  position: absolute;
  inset: -10%;
  background:
    radial-gradient(
      120% 80% at 50% 70%,
      rgba(255, 190, 120, 0.08),
      transparent 65%
    ),
    radial-gradient(
      120% 100% at 40% 20%,
      rgba(120, 170, 255, 0.06),
      transparent 70%
    );
  opacity: 0.6;
  mix-blend-mode: screen;
  pointer-events: none;
  animation: arena-shimmer 6s ease-in-out infinite;
}

.arena-frame img {
  image-rendering: pixelated;
}

:host-context(.battle-root.hit-pause) .arena-frame {
  animation-play-state: paused;
  transition: transform 60ms linear;
}

:host-context(.battle-root.is-paused) .arena-frame {
  filter: saturate(0.7) brightness(0.92);
}

:host-context(.battle-root.is-paused) .arena-frame * {
  animation-play-state: paused !important;
}

@keyframes arena-flicker {
  0% {
    opacity: calc(var(--vfx-ambient-opacity) - var(--vfx-flicker-strength));
  }
  50% {
    opacity: calc(var(--vfx-ambient-opacity) + var(--vfx-flicker-strength));
  }
  100% {
    opacity: calc(var(--vfx-ambient-opacity) - var(--vfx-flicker-strength));
  }
}

@keyframes arena-parallax {
  0% {
    transform: translate3d(0, 0, 0) scale(1.03);
  }
  50% {
    transform: translate3d(2px, -2px, 0) scale(1.03);
  }
  100% {
    transform: translate3d(-1px, 2px, 0) scale(1.03);
  }
}

@keyframes arena-shimmer {
  0%,
  100% {
    opacity: 0.35;
    transform: translate3d(0, 0, 0);
  }
  50% {
    opacity: 0.7;
    transform: translate3d(1px, -1px, 0);
  }
}

@media (prefers-reduced-motion: reduce) {
  .arena-frame::after {
    animation: none;
    opacity: calc(var(--vfx-ambient-opacity) * 0.6);
  }
  .arena-bg,
  .arena-layer--background::after {
    animation: none;
    transform: none;
  }
}

:host-context(.battle-root.reduce-motion) .arena-bg,
:host-context(.battle-root.reduce-motion) .arena-layer--background::after {
  animation: none;
  transform: none;
}

:host-context(.battle-root.reduce-motion) .arena-frame::after {
  animation: none;
  opacity: calc(var(--vfx-ambient-opacity) * 0.6);
}
